<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ ç¾é£ŸåˆèŒ¶å°åŠ©æ‰‹</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Varela+Round&display=swap" rel="stylesheet">
    <style>
        :root {
            --sweet-pink: #FF9A9E;
            --sweet-blue: #A1C4FD;
            --sweet-mint: #E2FAC7;
            --main-text: #5A5A5A;
        }

        body {
            font-family: 'Varela Round', 'Noto Sans TC', sans-serif;
            background: linear-gradient(120deg, #fdfbfb 0%, #ebedee 100%);
            margin: 0; padding: 0; color: var(--main-text);
        }

        header {
            background: linear-gradient(to right, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
            color: white; padding: 40px 20px; text-align: center;
            border-radius: 0 0 50px 50px; box-shadow: 0 4px 15px rgba(255,154,158,0.3);
        }

        .container { max-width: 500px; margin: -30px auto 50px; padding: 0 20px; }

        /* ç›®å‰ä½ç½®å€å¡Š */
        .location-tag {
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px; border-radius: 30px;
            font-size: 0.85rem; text-align: center;
            margin-bottom: 20px; border: 1px solid #eee;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .card {
            background: white; border-radius: 30px; padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); margin-bottom: 20px;
            border: 2px solid #f9f9f9;
        }

        .section-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 15px; color: #FF7675; }

        .chip-group { display: flex; flex-wrap: wrap; gap: 10px; }
        .chip-group input { display: none; }
        .chip-group label {
            padding: 10px 20px; border-radius: 20px; background: #f0f0f0; 
            cursor: pointer; font-size: 0.9rem; transition: 0.3s;
        }
        .chip-group input:checked + label { background: var(--sweet-pink); color: white; box-shadow: 0 4px 10px rgba(255,154,158,0.4); }

        .action-btn {
            width: 100%; padding: 18px; border: none; border-radius: 25px;
            background: linear-gradient(to right, #fa709a 0%, #fee140 100%);
            color: white; font-size: 1.3rem; font-weight: bold;
            cursor: pointer; margin-top: 25px; transition: 0.3s;
        }
        .action-btn:hover { transform: scale(1.03); }

        /* çµæœæ¸…å–® */
        .place-item {
            background: white; border-radius: 25px; overflow: hidden;
            margin-bottom: 20px; display: flex; align-items: center;
            padding: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.05);
            border: 1px solid #f0f0f0; animation: bounceIn 0.6s ease;
        }

        .m-box { width: 100px; height: 100px; border-radius: 20px; overflow: hidden; flex-shrink: 0; }
        .m-box img { width: 100%; height: 100%; object-fit: cover; }

        .info { padding-left: 15px; flex-grow: 1; }
        .name { font-size: 1.1rem; font-weight: bold; margin: 0 0 5px 0; color: #333; }
        .rating { color: #FAB1A0; font-weight: bold; font-size: 0.9rem; }
        .time-badge {
            display: inline-block; background: #E2FAC7; color: #557A27;
            padding: 4px 12px; border-radius: 10px; font-size: 0.8rem;
            margin-top: 8px; font-weight: bold;
        }

        .go-link {
            text-decoration: none; font-size: 1.2rem; margin-left: 10px;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.9); opacity: 0; }
            60% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }

        .loading { text-align: center; color: var(--sweet-pink); font-weight: bold; display: none; padding: 20px; }
    </style>
</head>
<body>

<header>
    <h1>ğŸ§ Today's Pick</h1>
    <p>é‡è¦‹å°ˆå±¬æ–¼ä½ çš„ç¾å‘³é©šå–œ</p>
</header>

<div class="container">
    <div id="current-pos" class="location-tag">ğŸ“ é»æ“ŠæŒ‰éˆ•ç²å–ä½ç½®...</div>

    <div class="card">
        <span class="section-title">âœ¨ æƒ³è¦ä»€éº¼æ¨£çš„é©šå–œï¼Ÿ</span>
        <div class="chip-group">
            <input type="radio" id="p1" name="b" value="1"><label for="p1">ğŸ’° éŠ…æ¿åƒ¹</label>
            <input type="radio" id="p2" name="b" value="2" checked><label for="p2">ğŸ° è³ªæ„Ÿç”Ÿæ´»</label>
            <input type="radio" id="p3" name="b" value="all"><label for="p3">ğŸ¡ æˆ‘ä¸æŒ‘</label>
        </div>

        <span class="section-title" style="margin-top:20px;">ğŸš² äº¤é€šç¯„åœ</span>
        <div class="chip-group">
            <input type="radio" id="m1" name="mode" value="WALKING" checked><label for="m1">æ¼«æ­¥</label>
            <input type="radio" id="m2" name="mode" value="TRANSIT"><label for="m2">æ­è»Š</label>
        </div>

        <button class="action-btn" onclick="startApp()">é–‹å§‹æ¢ç´¢ â”</button>
    </div>

    <div id="loading" class="loading">ğŸ¡ æ­£åœ¨ç‚ºæ‚¨æŒ‘é¸ä¸­...</div>
    <div id="results"></div>
</div>

<script>
    (g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));e.set("libraries",[...r]+"");for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);a.src=`https://maps.${c}apis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})({
        key: "AIzaSyAX02p-zEZMVHrIm3Lq-4WhC2EKr5pEki8", 
        v: "weekly"
    });
</script>

<script>
    let userPos, placeLib, directionsService;
    const apiKey = "AIzaSyAX02p-zEZMVHrIm3Lq-4WhC2EKr5pEki8";

    async function startApp() {
        const resultsDiv = document.getElementById('results');
        const loading = document.getElementById('loading');
        const posTag = document.getElementById('current-pos');

        resultsDiv.innerHTML = '';
        loading.style.display = 'block';

        if (!placeLib) placeLib = await google.maps.importLibrary("places");
        if (!directionsService) directionsService = new google.maps.DirectionsService();

        navigator.geolocation.getCurrentPosition(async (pos) => {
            userPos = { lat: pos.coords.latitude, lng: pos.coords.longitude };
            posTag.innerText = `ğŸ“ ç›®å‰ä½ç½®ï¼šç¶“åº¦ ${userPos.lng.toFixed(3)} / ç·¯åº¦ ${userPos.lat.toFixed(3)}`;

            const budget = document.querySelector('input[name="b"]:checked').value;
            const mode = document.querySelector('input[name="mode"]:checked').value;
            
            const radius = (mode === "WALKING") ? 1000 : 8000;

            const request = {
                textQuery: "é¤å»³ å°åƒ ç¾é£Ÿ",
                locationBias: { center: userPos, radius: radius },
                isOpenNow: true,
                fields: ['displayName', 'location', 'rating', 'id'],
                language: 'zh-TW',
                maxResultCount: 10
            };

            if(budget !== "all") request.priceLevels = [parseInt(budget)];

            try {
                const { places } = await placeLib.Place.searchByText(request);
                if (!places || places.length === 0) throw "Empty";

                const picked = places.sort(() => 0.5 - Math.random()).slice(0, 5);
                
                for (let place of picked) {
                    await getSimpleRoute(place, mode);
                }
                loading.style.display = 'none';
            } catch (e) {
                loading.style.display = 'none';
                alert("ğŸ¥º é™„è¿‘æ²’æ‰¾åˆ°ç¬¦åˆçš„åº—ï¼Œè©¦è©¦çœ‹ã€Œæˆ‘ä¸æŒ‘ã€æˆ–æ“´å¤§ç¯„åœå§ï¼");
            }
        });
    }

    async function getSimpleRoute(place, mode) {
        return new Promise((resolve) => {
            directionsService.route({
                origin: userPos,
                destination: place.location,
                travelMode: google.maps.TravelMode[mode]
            }, (result, status) => {
                if (status === 'OK') {
                    renderItem(place, result.routes[0].legs[0], mode);
                }
                resolve();
            });
        });
    }

    function renderItem(place, leg, mode) {
        const resDiv = document.getElementById('results');
        const lat = place.location.lat();
        const lng = place.location.lng();
        const icon = (mode === "WALKING") ? "ğŸš¶" : "ğŸšŒ";

        const path = `path=color:0xff9a9eff|weight:5|${userPos.lat},${userPos.lng}|${lat},${lng}`;
        const mapUrl = `https://maps.googleapis.com/maps/api/staticmap?size=200x200&markers=color:blue|size:tiny|${userPos.lat},${userPos.lng}&markers=color:red|${lat},${lng}&${path}&key=${apiKey}`;

        const html = `
            <div class="place-item">
                <div class="m-box"><img src="${mapUrl}"></div>
                <div class="info">
                    <p class="name">${place.displayName}</p>
                    <span class="rating">â˜… ${place.rating || 'N/A'}</span>
                    <div class="time-badge">${icon} ${leg.duration.text} (${leg.distance.text})</div>
                </div>
                <a class="go-link" href="https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}&travelmode=${mode.toLowerCase()}" target="_blank">ğŸš€</a>
            </div>
        `;
        resDiv.innerHTML += html;
    }
</script>

</body>
</html>