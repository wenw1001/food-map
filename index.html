<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gourmet Finder | æ¥µç°¡ç‰ˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --p: #FF4757; --bg: #F8F9FA; }
        body { font-family: 'Noto Sans TC', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .card { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h1 { color: var(--p); text-align: center; margin-top: 0; }
        .section-title { font-weight: bold; margin: 15px 0 10px; display: block; color: #555; }
        
        /* é¸é …æ¨£å¼ */
        .chip-group { display: flex; flex-wrap: wrap; gap: 8px; }
        .chip-group input { display: none; }
        .chip-group label { padding: 8px 15px; border-radius: 50px; background: #eee; cursor: pointer; font-size: 0.9rem; }
        .chip-group input:checked + label { background: var(--p); color: white; font-weight: bold; }

        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; background: var(--p); color: white; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 20px; }
        
        /* åº—å®¶æ¨£å¼ */
        .item { background: white; border-radius: 15px; overflow: hidden; margin-bottom: 15px; display: flex; box-shadow: 0 3px 10px rgba(0,0,0,0.05); }
        .m-box { width: 100px; height: 100px; flex-shrink: 0; }
        .m-box img { width: 100%; height: 100%; object-fit: cover; }
        .info { padding: 12px; flex-grow: 1; }
        .name { font-size: 1rem; font-weight: bold; margin: 0; }
        
        /* é™¤éŒ¯è¦–çª— */
        #debug { background: #333; color: #0f0; font-family: monospace; padding: 10px; border-radius: 10px; font-size: 11px; height: 150px; overflow-y: auto; margin-top: 20px; display: none; }
    </style>
</head>
<body>

<div class="card">
    <h1>ğŸ½ï¸ éš¨æ©Ÿæ‰¾ç¾é£Ÿ</h1>
    
    <span class="section-title">æ™‚æ®µ</span>
    <div class="chip-group">
        <input type="radio" id="s1" name="t" value="é¤å»³" checked><label for="s1">ä¸€èˆ¬æ™‚æ®µ</label>
        <input type="radio" id="s2" name="t" value="æ—©é¤åº—"><label for="s2">æ—©é¤</label>
        <input type="radio" id="s3" name="t" value="å®µå¤œ å°åƒ"><label for="s3">å®µå¤œ</label>
    </div>

    <span class="section-title">åƒ¹ä½</span>
    <div class="chip-group">
        <input type="radio" id="p1" name="b" value="1"><label for="p1">200å…§</label>
        <input type="radio" id="p2" name="b" value="2" checked><label for="p2">ä¸­åƒ¹ä½</label>
        <input type="radio" id="p3" name="b" value="all"><label for="p3">ä¸é™</label>
    </div>

    <span class="section-title">è·é›¢</span>
    <div class="chip-group">
        <input type="radio" id="m1" name="r" value="1000" checked><label for="m1">èµ°è·¯ (1km)</label>
        <input type="radio" id="m2" name="r" value="5000"><label for="m2">å¤§ç¯„åœ (5km)</label>
    </div>

    <button class="btn" onclick="run()">å¹«æˆ‘æ¨è–¦ 5 å®¶ï¼</button>
</div>

<div id="debug"></div>
<div id="res"></div>

<script>
    (g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));e.set("libraries",[...r]+"");for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);a.src=`https://maps.${c}apis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})({
        key: "AIzaSyAX02p-zEZMVHrIm3Lq-4WhC2EKr5pEki8", 
        v: "weekly"
    });
</script>

<script>
    const apiKey = "AIzaSyAX02p-zEZMVHrIm3Lq-4WhC2EKr5pEki8"; 
    let logBox = document.getElementById('debug');

    function log(msg) {
        logBox.style.display = 'block';
        logBox.innerHTML += `> ${msg}<br>`;
        logBox.scrollTop = logBox.scrollHeight;
        console.log(msg);
    }

    async function run() {
        log("1. é–‹å§‹åŸ·è¡Œ...");
        const resDiv = document.getElementById('res');
        resDiv.innerHTML = '';
        
        try {
            const lib = await google.maps.importLibrary("places");
            log("2. API åº«è¼‰å…¥æˆåŠŸ");

            navigator.geolocation.getCurrentPosition(async (pos) => {
                const myLoc = { lat: pos.coords.latitude, lng: pos.coords.longitude };
                log(`3. å®šä½æˆåŠŸ: ${myLoc.lat}, ${myLoc.lng}`);

                const q = document.querySelector('input[name="t"]:checked').value;
                const r = parseInt(document.querySelector('input[name="r"]:checked').value);
                const b = document.querySelector('input[name="b"]:checked').value;

                const request = {
                    textQuery: q,
                    locationBias: { center: myLoc, radius: r },
                    isOpenNow: true,
                    fields: ['displayName', 'location', 'rating'],
                    maxResultCount: 10
                };
                if(b !== 'all') request.priceLevels = [parseInt(b)];

                log(`4. æ­£åœ¨ç™¼é€æœå°‹è«‹æ±‚... (Query: ${q})`);
                const { places } = await lib.Place.searchByText(request);
                
                if (!places || places.length === 0) {
                    log("âš ï¸ æœå°‹å›å‚³ 0 ç­†çµæœã€‚å¯èƒ½æ˜¯åƒ¹ä½å¤ªåš´è‹›æˆ–å€åŸŸå¤ªååƒ»ã€‚");
                    return;
                }

                log(`5. æ‰¾åˆ° ${places.length} ç­†ï¼Œéš¨æ©ŸæŒ‘é¸ 5 ç­†ä¸­...`);
                const shuffled = places.sort(() => 0.5 - Math.random()).slice(0, 5);

                shuffled.forEach(p => {
                    const lat = p.location.lat();
                    const lng = p.location.lng();
                    const mapUrl = `https://maps.googleapis.com/maps/api/staticmap?size=200x200&markers=color:blue|${myLoc.lat},${myLoc.lng}&markers=color:red|${lat},${lng}&key=${apiKey}`;
                    
                    resDiv.innerHTML += `
                        <div class="item">
                            <div class="m-box"><img src="${mapUrl}"></div>
                            <div class="info">
                                <p class="name">${p.displayName}</p>
                                <p style="font-size:0.8rem; color:#f90;">â˜… ${p.rating || 'N/A'}</p>
                                <a href="https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}" target="_blank" style="font-size:0.8rem; color:blue;">å°èˆªå» â”</a>
                            </div>
                        </div>
                    `;
                });
                log("6. æ¸²æŸ“å®Œæˆï¼");

            }, (err) => {
                log(`âŒ å®šä½å¤±æ•—: ${err.message}`);
            });
        } catch (e) {
            log(`âŒ ç³»çµ±éŒ¯èª¤: ${e.message}`);
        }
    }
</script>

</body>
</html>